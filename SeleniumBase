using OpenQA.Selenium;
using OpenQA.Selenium.Interactions;
using OpenQA.Selenium.Support.UI;
using SeleniumExtras.WaitHelpers;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace AutomationLearingNov.Selenium
{

    public class SeleniumBase
    {
        protected IWebDriver driver;
        protected WebDriverWait wait;

        public SeleniumBase(IWebDriver webDriver)
        {
            driver = webDriver;
        }
        /// =========== Browser actions =============       
        public void NavigateToUrl(string url)
        {
            driver.Navigate().GoToUrl(url);
        }
        public string GetPageTitle()
        {
            return driver.Title;
        }
        public string GetCurrentUrl()
        {
            return driver.Url;
        }
        public void RefreshPage()
        {
            driver.Navigate().Refresh();
        }
        public void Forward()
        {
            driver.Navigate().Forward();
        }
        public void Back()
        {
            driver.Navigate().Back();
        }
        public void MaximizeWindow()
        {
            driver.Manage().Window.Maximize();
        }
        public void MinimizeWindow()
        {
            driver.Manage().Window.Minimize();
        }
        public void CloseBrowser()
        {
            driver.Close();
        }
        public void QuitBrowser()
        {
            driver.Quit();
        }

        /// =========== Element actions =============  
        public IWebElement FindElement(By locator)
        {
            return wait.Until(ExpectedConditions.ElementExists(locator));
        }
        public void ClickElement(By locator)
        {
            wait.Until(ExpectedConditions.ElementToBeClickable(locator)).Click();
        }
        public void EnterText(By locator, string text)
        {
            var element = FindElement(locator);
            element.Clear();
            element.SendKeys(text);
        }
        public string GetText(By locator)
        {
            return FindElement(locator).Text;
        }
        public bool IsElementDisplayed(By locator)
        {
            try
            {
                return FindElement(locator).Displayed;
            }
            catch (NoSuchElementException)
            {
                return false;
            }
        }

        /// =========== Wait actions =============
        public void WaitForVisible(By locator)
        {
            wait.Until(ExpectedConditions.ElementIsVisible(locator));
        }
        public void WaitForInVisible(By locator)
        {
            wait.Until(ExpectedConditions.InvisibilityOfElementLocated(locator));
        }
        public void WaitForClickable(By locator)
        {
            wait.Until(ExpectedConditions.ElementToBeClickable(locator)).Click();

        }

        public void WaitForText(By locator, string expectedText)
        {
            wait.Until(ExpectedConditions.TextToBePresentInElementLocated(locator, expectedText));
        }



        ///=========== DropDown =============
        public void SelectSingleDropdown(By locator, string type, string value)
        {

            if (type.Equals("text", StringComparison.OrdinalIgnoreCase))
            {
                var dropdown = new SelectElement(FindElement(locator));
                dropdown.SelectByText(value);
                return;
            }
            else if (type.Equals("index", StringComparison.OrdinalIgnoreCase))
            {
                var dropdown = new SelectElement(FindElement(locator));
                dropdown.SelectByIndex(Convert.ToInt32(value));
                return;
            }
            else if (type.Equals("value", StringComparison.OrdinalIgnoreCase))
            {
                var dropdown = new SelectElement(FindElement(locator));
                dropdown.SelectByValue(value);
                return;
            }
            else
            {
                throw new ArgumentException("Invalid selection type. Use 'text', 'index', or 'value'.");
            }
        }

        public void DeselectDropdown(By locator, string type, string value)
        {
            SelectElement dropdown= new SelectElement(FindElement(locator));
            if (!dropdown.IsMultiple)
            {
                throw new InvalidOperationException("This is not Multiple Dropdown");
            }
            if (type.Equals("text", StringComparison.OrdinalIgnoreCase))
            {
                dropdown.DeselectByText(value);
            }
            else if (type.Equals("value", StringComparison.OrdinalIgnoreCase))
            {
                dropdown.DeselectByValue(value);
            }
            else if (type.Equals("index", StringComparison.OrdinalIgnoreCase))
            {
                dropdown.DeselectByIndex(Convert.ToInt32(value));
            }
        }

        public IList<IWebElement> GetAllSelectedOptions(By locator)
        {
            return new SelectElement(FindElement(locator)).AllSelectedOptions;
        }
        public IList<IWebElement> GetAllOptions(By locator)
        {
            return new SelectElement(FindElement(locator)).Options;
        }
        ///===mouse actions===
        public void Hover(By locator)
        {
            Actions action = new Actions(driver);
            action.MoveToElement(FindElement(locator)).Perform();
        }
        public void DoubleClick(By locator)
        {
            Actions action = new Actions(driver);
            action.MoveToElement(FindElement(locator)).Perform();
        }
        public void RightClick(By locator)
        {
            Actions action = new Actions(driver);
            action.MoveToElement(FindElement(locator)).Perform();
        }

        //===keyboard actions===
        public void PressTab(By locator)
        {
            FindElement(locator).SendKeys(Keys.Tab);
        }
        public void PressEnter(By locator)
        {
            FindElement(locator).SendKeys(Keys.Enter);
        }
        public void PressSpace(By locator)
        {
            FindElement(locator).SendKeys(Keys.Space);
        }
        public void SendKeys(By locator, string text)
        {
            FindElement(locator).SendKeys(text);
        }
        ///=========== Alerts =============
        public void AcceptAlert()
        {
            driver.SwitchTo().Alert().Accept();
        }
        public void DismissAlert()
        {
            driver.SwitchTo().Alert().Dismiss();

        }
        public string GetAlertText()
        {
            return driver.SwitchTo().Alert().Text;
        }
        public void SendTextToAlert(string Text)
        {
            driver.SwitchTo().Alert().SendKeys(Text);
        }
        //// == JS Executor ==
        public void JsClick(By locator)
        {
            IJavaScriptExecutor js = (IJavaScriptExecutor)driver;
            js.ExecuteScript("arguments[0].click();", FindElement(locator));
        }
        public void ScrollToBottom()
        {
            IJavaScriptExecutor js = (IJavaScriptExecutor)driver;
            js.ExecuteScript("window.scrollTo(0,document.body.scrollHeight);");
        }
        public void ScrollToElement(By locator)
        {
            IJavaScriptExecutor js = (IJavaScriptExecutor)driver;
            js.ExecuteScript("arguments[0].scrollIntoView(true));", FindElement(locator));
        }
        public void JsSendKeys(By locator, string value)
        {
            IJavaScriptExecutor js = (IJavaScriptExecutor)driver;
            js.ExecuteScript("arguments[0].value='"+value+"';",FindElement(locator));

        }
        /// === frames====
        public void SwitchToDefaultContent()
        {
            driver.SwitchTo().DefaultContent();
        }
        public void SwitchToFrameByIndex(int index)
        {
            driver.SwitchTo().Frame(index);
        }
        public void SwitchToFrameByNameOrId(string nameOrId)
        {
            driver.SwitchTo().Frame(nameOrId);
        }
        public void SwitchToFrameByElement(By locator)
        {
            driver.SwitchTo().Frame(FindElement(locator));
        }
        public void SwitchToParentFrame()
        {
            driver.SwitchTo().ParentFrame();
        }
        /// === windows handling==
        public void SwitchToWindow(string windowTitle)
        {
            foreach (string window in driver.WindowHandles)
            {

            }
        }

        //Deselect from dropdown
        //Only for multi select dropdown
        //ismultiple should be true
        //Deselect by text, index, value
        //selected options
        //all options

        //hover , oubleclick ,contextclick
        //===keyboard actions===
        //tab, enter, space,keys

        ///=========== Alerts =============
        ///simple alert, confirm alert, prompt alert
        ///
        //// == JS Executor ==
        /// click , scrollto bottom, scrollto element, sendkeys
        /// === frames
        //default frame, frame by index, frame by name or id, frame by webelement
        //parent frame, main frame,nested frame


        /// ===screenshots===
    }
}

